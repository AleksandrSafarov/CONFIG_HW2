# Домашнее задание №2 по конфигурационному управлению
## Сделал студент группы ИКБО-11-23, Сафаров Александр Алексеевич
## Номер варианта: 20
## **Формулировка задачи**
Разработать инструмент командной строки для визуализации графа
зависимостей, включая транзитивные зависимости. Сторонние средства для
получения зависимостей использовать нельзя.
Зависимости определяются для git-репозитория. Для описания графа
зависимостей используется представление PlantUML. Визуализатор должен
выводить результат в виде сообщения об успешном выполнении и сохранять граф
в файле формата png.  
Построить граф зависимостей для коммитов, в узлах которого содержатся
номера коммитов в хронологическом порядке. Граф необходимо строить только
для коммитов ранее заданной даты.  
Ключами командной строки задаются:  
- Путь к программе для визуализации графов.  
- Путь к анализируемому репозиторию.  
- Путь к файлу с изображением графа зависимостей.  
- Дата коммитов в репозитории.  
Все функции визуализатора зависимостей должны быть покрыты тестами.  
## Описание
Проект написан на языке программирования Python. Ссылка на проект: https://github.com/AleksandrSafarov/CONFIG_HW2
### Запуск программы
1. Склонировать проект
2. Перейти в папку с проектом в терминале
3. Ввести команду
```
python main.py <путь к репозиторию> <дата, до которой надо найти коммиты (прим. 2024-01-01)> <путь к изображению> <путь к jar файлу>
```
### Запуск юнит тестов
1. Склонировать проект
2. Перейти в папку с проектом в терминале
3. Ввести команду
```
python -m unittest test.py
```

## Описание функций и настроек
### Функции

#### 1. `read_git_object(repo_path, object_hash)`
Читает и распаковывает Git-объект из директории `.git/objects`.

- **Параметры**:
  - `repo_path` (str): Путь к корневой директории Git-репозитория.
  - `object_hash` (str): Хэш объекта, который нужно прочитать.

- **Возвращает**: 
  - Распакованные данные объекта Git.

- **Исключения**: 
  - `FileNotFoundError`, если указанный объект не найден.

#### 2. `parse_commit_object(commit_data)`
Разбирает объект `commit` и извлекает его метаданные.

- **Параметры**:
  - `commit_data` (str): Содержимое объекта коммита в текстовом формате.

- **Возвращает**:
  - `tree_hash` (str): Хэш объекта дерева, связанного с коммитом.
  - `parents` (list): Список хэшей родительских коммитов.
  - `author_time` (int): Временная метка UNIX времени создания коммита.

#### 3. `get_all_commits(repo_path, date_before)`
Получает все коммиты, включая их хэши и временные метки, из репозитория, ограничивая список коммитами, сделанными до указанной даты.

- **Параметры**:
  - `repo_path` (str): Путь к корневой директории Git-репозитория.
  - `date_before` (int): Временная метка UNIX, до которой нужно искать коммиты.

- **Возвращает**:
  - Список хэшей коммитов, отсортированных по временной метке от самых ранних к самым поздним.

#### 4. `build_commit_graph(repo_path, date_before)`
Создает граф зависимостей коммитов, анализируя все объекты `commit`.

- **Параметры**:
  - `repo_path` (str): Путь к корневой директории Git-репозитория.
  - `date_before` (int): Временная метка UNIX, ограничивающая время коммитов для графа.

- **Возвращает**:
  - Словарь `commit_graph`, где ключи - хэши коммитов, а значения - списки хэшей родительских коммитов.

#### 5. `generate_plantuml(commit_graph)`
Генерирует текст для визуализации графа коммитов в формате PlantUML.

- **Параметры**:
  - `commit_graph` (dict): Граф зависимостей коммитов в виде словаря.

- **Возвращает**:
  - Строку текста, представляющую граф зависимостей в формате PlantUML.

#### 6. `save_plantuml_file(plantuml_text, plantuml_file_path)`
Сохраняет текст PlantUML в файл с указанным путем.

- **Параметры**:
  - `plantuml_text` (str): Текст графа PlantUML.
  - `plantuml_file_path` (str): Путь для сохранения файла с расширением `.puml`.

#### 7. `generate_graph_image(plantuml_file_path, output_image_path, plantuml_jar_path)`
Создает изображение из файла PlantUML, используя JAR-файл PlantUML.

- **Параметры**:
  - `plantuml_file_path` (str): Путь к файлу PlantUML.
  - `output_image_path` (str): Путь для сохранения изображения графа.
  - `plantuml_jar_path` (str): Путь к JAR-файлу PlantUML.

- **Исключения**:
  - `Exception`, если возникла ошибка при выполнении PlantUML.

#### 8. `main(repo_path, date_before, output_image_path, plantuml_jar_path)`
Основная функция, которая выполняет весь процесс построения графа коммитов.

- **Параметры**:
  - `repo_path` (str): Путь к корневой директории Git-репозитория.
  - `date_before` (str): Дата в формате `ГГГГ-ММ-ДД`, до которой нужно искать коммиты.
  - `output_image_path` (str): Путь для сохранения изображения графа.
  - `plantuml_jar_path` (str): Путь к JAR-файлу PlantUML. 

- **Описание**:
  - Преобразует `date_before` в UNIX-время, создает граф коммитов, генерирует текст PlantUML, сохраняет его и создает изображение.

## Тестирование
Рисунок 1. Пример построенного графа
![Image alt](https://github.com/AleksandrSafarov/CONFIG_HW1/blob/main/CONFIG_HW2/graph_test.png)
